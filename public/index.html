<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Reveal - Retro Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --retro-black: #0a0a2a;
            --retro-dark: #222034;
            --retro-purple: #493c96;
            --retro-blue: #4b80ca;
            --retro-green: #00ff00;
            --retro-yellow: #ffcd75;
            --retro-orange: #ff8b33;
            --retro-red: #e43b44;
            --retro-pink: #ff00ff;
            --retro-white: #f4f4f4;
        }

        body {
            background-color: var(--retro-black);
            color: var(--retro-white);
            font-family: 'Press Start 2P', monospace;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            overflow: hidden;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .canvas-container {
            position: relative;
            width: 600px;
            height: 600px;
            margin: 0 auto;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
        }

        #gameCanvas {
            z-index: 1;
            border: 4px solid var(--retro-blue);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        #uiCanvas {
            z-index: 2;
            pointer-events: none; /* Permite que los clics pasen al canvas de abajo */
        }

        .hud {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 3;
            display: none;
        }

        .lcd-display {
            background-color: #001100;
            color: var(--retro-green);
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            text-shadow: 0 0 5px var(--retro-green);
            margin-bottom: 5px;
            border: 1px solid var(--retro-green);
        }

        .hearts {
            display: flex;
            gap: 5px;
        }

        .heart {
            width: 20px;
            height: 20px;
            filter: drop-shadow(0 0 2px var(--retro-pink));
        }

        .credit {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: var(--retro-yellow);
            font-size: 10px;
            text-shadow: 0 0 5px var(--retro-orange);
        }

        .hidden {
            display: none;
        }

        /* Efectos de animación */
        @keyframes pulse {
            0% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.05); filter: brightness(1.2); }
            100% { transform: scale(1); filter: brightness(1); }
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .blink {
            animation: blink 0.5s infinite;
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div class="game-container">
        <div class="canvas-container">
            <canvas id="gameCanvas" width="600" height="600"></canvas>
            <canvas id="uiCanvas" width="600" height="600"></canvas>
        </div>
        
        <div class="hud" id="gameHud">
            <div class="lcd-display" id="percentDisplay">CLEAR: 0.0%/80</div>
            <div class="lcd-display" id="timeDisplay">TIME: 180</div>
            <div class="hearts" id="livesDisplay">
                <!-- Hearts will be added dynamically -->
            </div>
        </div>
        
        <div class="credit">pkNoCREDIT</div>
    </div>

    <script>
        // Variables globales
        const gameCanvas = document.getElementById('gameCanvas');
        const uiCanvas = document.getElementById('uiCanvas');
        const gameCtx = gameCanvas.getContext('2d');
        const uiCtx = uiCanvas.getContext('2d');
        const gameHud = document.getElementById('gameHud');
        const percentDisplay = document.getElementById('percentDisplay');
        const timeDisplay = document.getElementById('timeDisplay');
        const livesDisplay = document.getElementById('livesDisplay');
        
        // Estados del juego
        const GameState = {
            MENU: 'menu',
            SELECTION: 'selection',
            PLAYING: 'playing',
            GAME_OVER: 'gameOver',
            WIN: 'win'
        };
        
        let currentState = GameState.MENU;
        let gameInstance = null;
        let transitionProgress = 0;
        let isTransitioning = false;
        let targetState = null;
        
        // Recursos
        const resources = {
            images: {},
            sounds: {},
            loaded: false,
            toLoad: 4,
            loadedCount: 0
        };
        
        // Cargar recursos
        function loadResources() {
            const imagesToLoad = [
                { name: 'heart', src: 'assets/heart.png' },
                { name: 'bgMenu', src: 'assets/bg_menu.png' },
                { name: 'buttonBg', src: 'assets/button_bg.png' },
                { name: 'circleTransition', src: 'assets/circle_transition.png' }
            ];
            
            imagesToLoad.forEach(img => {
                resources.images[img.name] = new Image();
                resources.images[img.name].onload = () => {
                    resources.loadedCount++;
                    if (resources.loadedCount === resources.toLoad) {
                        resources.loaded = true;
                        init();
                    }
                };
                resources.images[img.name].src = img.src;
            });
        }
        
        // Inicializar el juego
        function init() {
            // Configurar eventos
            uiCanvas.addEventListener('click', handleClick);
            window.addEventListener('keydown', handleKeyDown);
            
            // Iniciar el bucle de renderizado
            requestAnimationFrame(gameLoop);
        }
        
        // Bucle principal del juego
        function gameLoop(timestamp) {
            // Limpiar los canvas
            gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
            uiCtx.clearRect(0, 0, uiCanvas.width, uiCanvas.height);
            
            // Actualizar según el estado actual
            switch(currentState) {
                case GameState.MENU:
                    renderMenu();
                    break;
                case GameState.SELECTION:
                    renderSelection();
                    break;
                case GameState.PLAYING:
                    renderGame();
                    break;
                case GameState.GAME_OVER:
                    renderGameOver();
                    break;
                case GameState.WIN:
                    renderWin();
                    break;
            }
            
            // Manejar transiciones
            if (isTransitioning) {
                renderTransition();
            }
            
            // Continuar el bucle
            requestAnimationFrame(gameLoop);
        }
        
        // Renderizar el menú principal
        function renderMenu() {
            // Dibujar fondo
            gameCtx.drawImage(resources.images.bgMenu, 0, 0, gameCanvas.width, gameCanvas.height);
            
            // Dibujar título
            uiCtx.fillStyle = '#ff00ff';
            uiCtx.font = '40px "Press Start 2P"';
            uiCtx.textAlign = 'center';
            uiCtx.shadowColor = '#ff00ff';
            uiCtx.shadowBlur = 15;
            uiCtx.fillText('IMAGE', uiCanvas.width/2, uiCanvas.height/3 - 30);
            uiCtx.fillText('REVEAL', uiCanvas.width/2, uiCanvas.height/3 + 30);
            uiCtx.shadowBlur = 0;
            
            // Dibujar botón PLAY
            const btnWidth = 200;
            const btnHeight = 60;
            const btnX = (uiCanvas.width - btnWidth) / 2;
            const btnY = uiCanvas.height * 0.6;
            
            uiCtx.drawImage(resources.images.buttonBg, btnX, btnY, btnWidth, btnHeight);
            
            uiCtx.fillStyle = '#ffffff';
            uiCtx.font = '24px "Press Start 2P"';
            uiCtx.fillText('PLAY', uiCanvas.width/2, btnY + btnHeight/2 + 8);
            
            // Dibujar instrucciones
            uiCtx.fillStyle = '#ffcd75';
            uiCtx.font = '12px "Press Start 2P"';
            uiCtx.fillText('ARROWS: MOVE', uiCanvas.width/2, uiCanvas.height * 0.8);
            uiCtx.fillText('SPACE: DRAW', uiCanvas.width/2, uiCanvas.height * 0.85);
        }
        
        // Renderizar la pantalla de selección
        function renderSelection() {
            // Fondo
            gameCtx.fillStyle = '#0a0a2a';
            gameCtx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
            
            // Título
            uiCtx.fillStyle = '#00ff00';
            uiCtx.font = '24px "Press Start 2P"';
            uiCtx.textAlign = 'center';
            uiCtx.shadowColor = '#00ff00';
            uiCtx.shadowBlur = 10;
            uiCtx.fillText('SELECT IMAGE', uiCanvas.width/2, 80);
            uiCtx.shadowBlur = 0;
            
            // Opciones de imágenes (simplificado para este ejemplo)
            const options = [
                { name: 'NAMI', x: 150, y: 200, w: 120, h: 120 },
                { name: 'LUFFY', x: 330, y: 200, w: 120, h: 120 },
                { name: 'ZORO', x: 150, y: 350, w: 120, h: 120 },
                { name: 'SANJI', x: 330, y: 350, w: 120, h: 120 }
            ];
            
            options.forEach(option => {
                // Dibujar marco
                uiCtx.strokeStyle = '#ff00ff';
                uiCtx.lineWidth = 3;
                uiCtx.shadowColor = '#ff00ff';
                uiCtx.shadowBlur = 10;
                uiCtx.strokeRect(option.x, option.y, option.w, option.h);
                uiCtx.shadowBlur = 0;
                
                // Dibujar nombre
                uiCtx.fillStyle = '#ffffff';
                uiCtx.font = '16px "Press Start 2P"';
                uiCtx.textAlign = 'center';
                uiCtx.fillText(option.name, option.x + option.w/2, option.y + option.h + 30);
            });
            
            // Botón de regreso
            uiCtx.fillStyle = '#ffcd75';
            uiCtx.font = '14px "Press Start 2P"';
            uiCtx.textAlign = 'center';
            uiCtx.fillText('BACK', 60, 550);
        }
        
        // Renderizar el juego principal
        function renderGame() {
            // En un juego real, aquí se renderizaría el estado actual del juego
            // Para este ejemplo, solo mostraremos un placeholder
            gameCtx.fillStyle = '#0a0a2a';
            gameCtx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
            
            // Mostrar el HUD
            gameHud.style.display = 'block';
            
            // Actualizar el HUD (valores de ejemplo)
            percentDisplay.textContent = `CLEAR: 45.2%/80`;
            timeDisplay.textContent = `TIME: 120`;
            
            // Actualizar vidas
            updateLives(3);
            
            // Dibujar imagen de fondo (simulada)
            gameCtx.globalAlpha = 0.3;
            gameCtx.fillStyle = '#4b80ca';
            gameCtx.fillRect(50, 50, 500, 500);
            gameCtx.globalAlpha = 1.0;
            
            // Dibujar área revelada (simulada)
            gameCtx.fillStyle = 'rgba(0,0,0,0)';
            gameCtx.clearRect(100, 100, 200, 200);
            
            // Dibujar jugador (simulado)
            uiCtx.fillStyle = '#00ff00';
            uiCtx.fillRect(295, 295, 10, 10);
        }
        
        // Renderizar pantalla de game over
        function renderGameOver() {
            // Fondo oscurecido
            gameCtx.fillStyle = 'rgba(10, 10, 42, 0.8)';
            gameCtx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
            
            // Texto de Game Over
            uiCtx.fillStyle = '#e43b44';
            uiCtx.font = '48px "Press Start 2P"';
            uiCtx.textAlign = 'center';
            uiCtx.shadowColor = '#e43b44';
            uiCtx.shadowBlur = 15;
            uiCtx.fillText('GAME', uiCanvas.width/2, uiCanvas.height/2 - 30);
            uiCtx.fillText('OVER', uiCanvas.width/2, uiCanvas.height/2 + 30);
            uiCtx.shadowBlur = 0;
            
            // Botón de reintentar
            const btnWidth = 200;
            const btnHeight = 60;
            const btnX = (uiCanvas.width - btnWidth) / 2;
            const btnY = uiCanvas.height * 0.7;
            
            uiCtx.drawImage(resources.images.buttonBg, btnX, btnY, btnWidth, btnHeight);
            
            uiCtx.fillStyle = '#ffffff';
            uiCtx.font = '24px "Press Start 2P"';
            uiCtx.fillText('RETRY', uiCanvas.width/2, btnY + btnHeight/2 + 8);
        }
        
        // Renderizar pantalla de victoria
        function renderWin() {
            // Fondo con efecto
            gameCtx.fillStyle = 'rgba(10, 10, 42, 0.8)';
            gameCtx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
            
            // Texto de victoria
            uiCtx.fillStyle = '#00ff00';
            uiCtx.font = '48px "Press Start 2P"';
            uiCtx.textAlign = 'center';
            uiCtx.shadowColor = '#00ff00';
            uiCtx.shadowBlur = 15;
            uiCtx.fillText('CLEAR!', uiCanvas.width/2, uiCanvas.height/2);
            uiCtx.shadowBlur = 0;
            
            // Efecto de confeti (simplificado)
            for (let i = 0; i < 50; i++) {
                uiCtx.fillStyle = getRandomColor();
                const x = Math.random() * uiCanvas.width;
                const y = Math.random() * uiCanvas.height;
                const size = Math.random() * 10 + 5;
                uiCtx.fillRect(x, y, size, size);
            }
            
            // Botón de continuar
            const btnWidth = 200;
            const btnHeight = 60;
            const btnX = (uiCanvas.width - btnWidth) / 2;
            const btnY = uiCanvas.height * 0.7;
            
            uiCtx.drawImage(resources.images.buttonBg, btnX, btnY, btnWidth, btnHeight);
            
            uiCtx.fillStyle = '#ffffff';
            uiCtx.font = '24px "Press Start 2P"';
            uiCtx.fillText('NEXT', uiCanvas.width/2, btnY + btnHeight/2 + 8);
        }
        
        // Renderizar transición entre estados
        function renderTransition() {
            transitionProgress += 0.02;
            
            if (transitionProgress >= 1) {
                isTransitioning = false;
                transitionProgress = 0;
                currentState = targetState;
                
                // Si cambiamos al estado de juego, inicializar el juego
                if (currentState === GameState.PLAYING) {
                    initGame();
                }
                
                return;
            }
            
            // Efecto de círculo expandiéndose
            const size = uiCanvas.width * 2 * transitionProgress;
            const x = uiCanvas.width / 2 - size / 2;
            const y = uiCanvas.height / 2 - size / 2;
            
            uiCtx.save();
            uiCtx.globalCompositeOperation = 'source-over';
            uiCtx.drawImage(resources.images.circleTransition, x, y, size, size);
            uiCtx.restore();
        }
        
        // Inicializar el juego
        function initGame() {
            // Aquí se inicializaría el juego real
            // Para este ejemplo, solo mostramos el HUD
            gameHud.style.display = 'block';
        }
        
        // Actualizar las vidas en el HUD
        function updateLives(lives) {
            livesDisplay.innerHTML = '';
            for (let i = 0; i < lives; i++) {
                const heart = document.createElement('img');
                heart.src = 'assets/heart.png';
                heart.className = 'heart';
                livesDisplay.appendChild(heart);
            }
        }
        
        // Manejar clics
        function handleClick(e) {
            if (isTransitioning) return;
            
            const rect = uiCanvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (uiCanvas.width / rect.width);
            const y = (e.clientY - rect.top) * (uiCanvas.height / rect.height);
            
            switch(currentState) {
                case GameState.MENU:
                    // Verificar si se hizo clic en el botón PLAY
                    if (x > 200 && x < 400 && y > 360 && y < 420) {
                        startTransition(GameState.SELECTION);
                    }
                    break;
                    
                case GameState.SELECTION:
                    // Verificar si se hizo clic en alguna imagen
                    if (x > 150 && x < 270 && y > 200 && y < 320) {
                        // NAMI seleccionada
                        startTransition(GameState.PLAYING);
                    } else if (x > 330 && x < 450 && y > 200 && y < 320) {
                        // LUFFY seleccionado
                        startTransition(GameState.PLAYING);
                    } else if (x > 150 && x < 270 && y > 350 && y < 470) {
                        // ZORO seleccionado
                        startTransition(GameState.PLAYING);
                    } else if (x > 330 && x < 450 && y > 350 && y < 470) {
                        // SANJI seleccionado
                        startTransition(GameState.PLAYING);
                    } else if (x < 100 && y > 530) {
                        // Botón BACK
                        startTransition(GameState.MENU);
                    }
                    break;
                    
                case GameState.GAME_OVER:
                    // Verificar si se hizo clic en el botón RETRY
                    if (x > 200 && x < 400 && y > 420 && y < 480) {
                        startTransition(GameState.PLAYING);
                    }
                    break;
                    
                case GameState.WIN:
                    // Verificar si se hizo clic en el botón NEXT
                    if (x > 200 && x < 400 && y > 420 && y < 480) {
                        startTransition(GameState.MENU);
                    }
                    break;
            }
        }
        
        // Manejar teclas
        function handleKeyDown(e) {
            if (isTransitioning) return;
            
            if (e.key === 'Enter' || e.key === ' ') {
                switch(currentState) {
                    case GameState.MENU:
                        startTransition(GameState.SELECTION);
                        break;
                    case GameState.GAME_OVER:
                        startTransition(GameState.PLAYING);
                        break;
                    case GameState.WIN:
                        startTransition(GameState.MENU);
                        break;
                }
            } else if (e.key === 'Escape') {
                if (currentState === GameState.PLAYING) {
                    startTransition(GameState.MENU);
                }
            }
            
            // Para demostración, teclas para cambiar entre estados
            if (e.key === '1') startTransition(GameState.MENU);
            if (e.key === '2') startTransition(GameState.SELECTION);
            if (e.key === '3') startTransition(GameState.PLAYING);
            if (e.key === '4') startTransition(GameState.GAME_OVER);
            if (e.key === '5') startTransition(GameState.WIN);
        }
        
        // Iniciar una transición a un nuevo estado
        function startTransition(newState) {
            isTransitioning = true;
            transitionProgress = 0;
            targetState = newState;
            
            // Ocultar el HUD durante las transiciones
            if (newState !== GameState.PLAYING) {
                gameHud.style.display = 'none';
            }
        }
        
        // Utilidades
        function getRandomColor() {
            const colors = ['#ff00ff', '#00ff00', '#ffcd75', '#4b80ca', '#e43b44'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // Iniciar carga de recursos
        loadResources();
    </script>
</body>
</html>